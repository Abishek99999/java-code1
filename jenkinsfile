pipeline {
    agent any
    tools {
        maven 'maven'
    }

    stages {
        stage('test') {
            steps {
                // Run tests
                sh 'mvn test'
            }
        }

        stage('build') {
            steps {
                // Package the application
                sh 'mvn package'
            }
        }

        stage('deploy on test') {
            steps {
                // Deploy to the test environment
                deploy adapters: [tomcat9(credentialsId: 'tomcat9details', path: '', url: 'http://10.0.128.210:8080')], contextPath: '/test', war: '**/*.war'
            }
        }

        stage('approval for production deployment') {
            input {
                message "Can we further execute this?"
                ok "Yes"
            }
            steps {
                echo "Permission granted for further execution"
            }
        }

        stage('deploy on prod') {
            steps {
                // Deploy to the production environment
                deploy adapters: [tomcat9(credentialsId: 'tomcat9details', path: '', url: 'http://10.0.128.187:8080')], contextPath: '/test', war: '**/*.war'
            }
        }
    }
}
